<!-- MODAL PLANILLA DIARIA -->
<div id="modal-planilla" class="modal-refactor">
    <div class="modal-contenido-refactor modal-erp-producto modal-agregar-producto-grande">
        <span class="cerrar" onclick="cerrarModalPlanilla()">&times;</span>
        <h2 class="modal-titulo-principal"><i class="fas fa-clipboard-list"></i> Reparaciones del <span
                id="fecha-planilla"></span></h2>

        <!-- Tabla reparaciones -->
        <div class="erp-table-card">
            <table class="tabla-erp">
                <thead>
                    <tr>
                        <th>Cliente</th>
                        <th>ID Reparaci√≥n</th>
                        <th>N¬∫ Coche</th>
                        <th>Equipo</th>
                        <th>T√©cnico</th>
                        <th>Garant√≠a</th>
                        <th>Observaciones</th>
                    </tr>
                </thead>
                <tbody id="tbody-reparaciones"></tbody>
                <!-- JS carga -->
                </tbody>
            </table>
        </div>

        <!-- PANEL FLOTANTE -->
        <div class="erp-panel-flotante">
            <button id="btn-ver-detalle" class="icon-button-erp visualizar" title="Ver Detalle">
                <i class="fas fa-eye"></i></button>
            <button id="btn-agregar-rep" class="icon-button-erp agregar" title="Agregar"><i
                    class="fas fa-plus"></i></button>
            <button id="btn-modificar-rep" class="icon-button-erp modificar" title="Editar"><i
                    class="fas fa-edit"></i></button>
            <button id="btn-eliminar-rep" class="icon-button-erp eliminar" title="Eliminar"><i
                    class="fas fa-trash"></i></button>
        </div>
    </div>
</div>

<!-- MODAL REPARACI√ìN DIARIA -->
<div id="modal-reparacion" class="modal-refactor" tabindex="-1">
    <div class="modal-contenido-refactor modal-erp-producto modal-agregar-producto-grande">
        <span class="cerrar" onclick="cerrarModalReparacion()">&times;</span>
        <h2 class="modal-titulo-principal" id="modal-titulo-reparacion">
            <i class="fas fa-tools"></i> Nueva Reparaci√≥n
        </h2>

        <!-- üëá ac√° abr√≠s el form -->
        <form id="form-reparacion" autocomplete="off">

            <div class="form-grid">
                <div>
                    <label>Cliente *</label>
                    <select id="cliente_tipo" name="cliente_tipo" required>
                        <option value="">Seleccione cliente</option>
                        <option value="dota">Dota</option>
                        <option value="externo">Externo</option>
                    </select>
                </div>

                <!-- Select adicional (solo visible si se elige Externo) -->
                <div id="cliente_externo_wrapper" style="display:none;">
                    <label>Seleccione cliente externo *</label>
                    <select id="cliente_id" name="cliente_id">
                        <option value="">Seleccione</option>
                        <!-- JS cargar√° aqu√≠ -->
                    </select>
                </div>
            </div>

            <!-- ID Reparaci√≥n + N¬∫ Coche -->
            <div class="form-grid doble">
                <div>
                    <label>ID Reparaci√≥n (nuestro) *</label>
                    <input type="text" name="id_reparacion" maxlength="20" required />
                </div>
                <div>
                    <label>N¬∫ Coche</label>
                    <input type="text" name="coche_numero" maxlength="20" />
                </div>
            </div>

            <!-- Equipo -->
            <div class="form-grid">
                <div>
                    <label>Equipo/Familia *</label>
                    <select id="familia_id" name="familia_id">
                        <option value="">Seleccione un equipo</option>
                    </select>
                </div>
            </div>

            <!-- T√©cnico -->
            <div class="form-grid">
                <div>
                    <label>T√©cnico asignado *</label>
                    <select id="tecnico_id" name="tecnico_id" required>
                        <option value="">Seleccione t√©cnico</option>
                    </select>
                </div>
            </div>

            <!-- Horarios -->
            <div class="form-grid doble">
                <div>
                    <label>Hora inicio *</label>
                    <input type="time" name="hora_inicio" />
                </div>
                <div>
                    <label>Hora fin</label>
                    <input type="time" name="hora_fin" />
                </div>
            </div>

            <!-- Trabajo / Repuestos -->
            <div class="form-grid">
                <div>
                    <label>Trabajo realizado / Repuestos *</label>
                    <textarea name="trabajo" id="trabajo" rows="3" required></textarea>
                    <button type="button" id="btn-seleccionar-repuesto" class="btn-secundario">
                        <i class="fas fa-cubes"></i> Seleccionar Repuesto
                    </button>
                </div>
            </div>


            <!-- Garant√≠a -->
            <div class="form-grid">
                <div>
                    <label>¬øEs garant√≠a?</label>
                    <select name="garantia" id="garantia">
                        <option value="no">No</option>
                        <option value="si">S√≠</option>
                    </select>
                </div>
            </div>

            <!-- Campos visibles solo si es garant√≠a -->
            <div id="garantia-extra-fields" style="display: none; margin-top: 10px;">
                <div class="form-grid">
                    <div>
                        <label for="id_dota">ID DOTA</label>
                        <input type="number" name="id_dota" id="id_dota" placeholder="N¬∞ DOTA" />
                    </div>

                    <div>
                        <label for="ultimo_reparador">√öltimo Reparador</label>
                        <select name="ultimo_reparador" id="ultimo_reparador">
                            <option value="">Seleccione</option>
                        </select>
                    </div>

                    <div>
                        <label for="resolucion">Resoluci√≥n</label>
                        <select name="resolucion" id="resolucion">
                            <option value="">Seleccione</option>
                            <option value="aceptada">Aceptada</option>
                            <option value="rechazada">Rechazada (Facturada)</option>
                            <option value="funciona_ok">Funciona OK (Devoluci√≥n)</option>
                        </select>
                    </div>
                </div>
            </div>


            <!-- Observaciones -->
            <div class="form-grid">
                <div>
                    <label>Observaciones</label>
                    <textarea name="observaciones" rows="2"></textarea>
                </div>
            </div>

            <button type="submit" class="btn-guardar">
                <i class="fas fa-save"></i> Guardar Reparaci√≥n
            </button>
        </form> <!-- üëà cierre correcto -->
    </div>
</div>


<div id="modal-grupos" class="modal-refactor">
    <div class="modal-contenido modal-erp-producto tabla-chica">
        <span class="cerrar" onclick="cerrarModalGrupos()">&times;</span>
        <h2 class="modal-titulo-principal"><i class="fas fa-layer-group"></i> Seleccionar Grupo</h2>
        <div class="erp-table-card">
            <table class="tabla-erp">
                <thead>
                    <tr>
                        <th>Seleccionar</th>
                        <th>Grupo</th>
                    </tr>
                </thead>
                <tbody id="tbody-grupos"></tbody>
            </table>
        </div>
    </div>
</div>

<div id="modal-productos" class="modal-refactor">
    <div class="modal-contenido modal-erp-producto tabla-chica">
        <span class="cerrar" onclick="cerrarModalProductos()">&times;</span>
        <h2 class="modal-titulo-principal"><i class="fas fa-box-open"></i> Seleccionar Producto</h2>
        <div class="erp-table-card">
            <table class="tabla-erp">
                <thead>
                    <tr>
                        <th>Seleccionar</th>
                        <th>Producto</th>
                        <th>C√≥digo</th>
                    </tr>
                </thead>
                <tbody id="tbody-productos"></tbody>
            </table>
        </div>
    </div>
</div>


<!-- MODAL DETALLE REPARACI√ìN -->
<div id="modal-detalle" class="modal-refactor">
    <div class="modal-contenido-refactor modal-erp-producto modal-agregar-producto-grande">
        <span class="cerrar" onclick="cerrarModalDetalle()">&times;</span>
        <h2 class="modal-titulo-principal">
            <i class="fas fa-info-circle"></i> Detalle de Reparaci√≥n
        </h2>

        <div class="detalle-grid">
            <p><b>Cliente:</b> <span id="detalle-cliente"></span></p>
            <p><b>ID Reparaci√≥n:</b> <span id="detalle-id-reparacion"></span></p>
            <p><b>N¬∫ Coche:</b> <span id="detalle-coche"></span></p>
            <p><b>Equipo:</b> <span id="detalle-equipo"></span></p>
            <p><b>T√©cnico:</b> <span id="detalle-tecnico"></span></p>
            <p><b>Hora inicio:</b> <span id="detalle-hora-inicio"></span></p>
            <p><b>Hora fin:</b> <span id="detalle-hora-fin"></span></p>
            <p><b>Trabajo:</b> <span id="detalle-trabajo"></span></p>
            <p><b>Garant√≠a:</b> <span id="detalle-garantia"></span></p>
            <p><b>Observaciones:</b> <span id="detalle-observaciones"></span></p>
            <!-- Bloque extra solo visible si es garant√≠a -->
            <div id="detalle-garantia-extra" style="display: none; margin-top: 10px;">
                <hr>
                <p><b>ID DOTA:</b> <span id="detalle-id-dota"></span></p>
                <p><b>√öltimo Reparador:</b> <span id="detalle-ultimo-reparador"></span></p>
                <p><b>Resoluci√≥n:</b> <span id="detalle-resolucion"></span></p>
            </div>

        </div>
    </div>
</div>

<!-- MODAL HISTORIAL REPARACIONES -->
<div id="modal-historial" class="modal-refactor">
    <div class="modal-contenido modal-historial-ancho">
        <span class="cerrar" onclick="cerrarModalHistorial()">&times;</span>
        <h2 class="modal-titulo-principal">
            <i class="fas fa-history"></i> Historial de Reparaciones
        </h2>

        <!-- Datos fijos del equipo -->
        <div class="historial-header">
            <div><b>ID Reparaci√≥n:</b> <span id="historial-id"></span></div>
            <div><b>Cliente:</b> <span id="historial-cliente"></span></div>
            <div><b>Equipo:</b> <span id="historial-equipo"></span></div>
            <div><b>N¬∫ Coche:</b> <span id="historial-coche"></span></div>
        </div>

        <!-- Datos de garant√≠a -->
        <div id="historial-garantia-extra" class="historial-header garantia-extra" style="display:none;">
            <div><b>ID DOTA:</b> <span id="historial-id-dota">-</span></div>
            <div><b>√öltimo reparador:</b> <span id="historial-ultimo-reparador">-</span></div>
            <div><b>Resoluci√≥n:</b> <span id="historial-resolucion">-</span></div>
        </div>



        <!-- Tabla de reparaciones -->
        <div class="erp-table-card historial-tabla">
            <table class="tabla-erp">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Trabajo</th>
                        <th>Hora inicio</th>
                        <th>Hora fin</th>
                        <th>T√©cnico</th>
                        <th>Garant√≠a</th>
                    </tr>
                </thead>
                <tbody id="tbody-historial">
                    <!-- JS carga -->
                </tbody>
            </table>
        </div>
    </div>
</div>