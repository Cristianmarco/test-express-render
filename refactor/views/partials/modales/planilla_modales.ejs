<!-- MODAL PLANILLA DIARIA -->
<div id="modal-planilla" class="modal-refactor">
  <div class="modal-contenido-refactor modal-erp-producto modal-agregar-producto-grande">
    <span class="cerrar" onclick="cerrarModalPlanilla()">&times;</span>
    <h2 class="modal-titulo-principal"><i class="fas fa-clipboard-list"></i> Reparaciones del <span id="fecha-planilla"></span></h2>

    <div class="erp-table-card">
      <table class="tabla-erp">
        <thead>
          <tr>
            <th>Cliente</th>
            <th>ID Reparacion</th>
            <th>Nro Coche</th>
            <th>Equipo</th>
            <th>Tecnico</th>
            <th>Garantia</th>
            <th>Observaciones</th>
          </tr>
        </thead>
        <tbody id="tbody-reparaciones"></tbody>
      </table>
    </div>

    <div class="erp-panel-flotante">
      <button id="btn-ver-detalle" class="icon-button-erp visualizar" title="Ver Detalle"><i class="fas fa-eye"></i></button>
      <button id="btn-agregar-rep" class="icon-button-erp agregar" title="Agregar"><i class="fas fa-plus"></i></button>
      <button id="btn-modificar-rep" class="icon-button-erp modificar" title="Editar"><i class="fas fa-edit"></i></button>
      <button id="btn-eliminar-rep" class="icon-button-erp eliminar" title="Eliminar"><i class="fas fa-trash"></i></button>
      <div class="panel-spacer"></div>
      <div class="panel-counter" title="Cantidad de equipos del día">
        <i class="fas fa-list-check"></i>
        <span style="opacity:.8">Equipos:</span>
        <span id="planilla-count">0</span>
      </div>
    </div>
  </div>
</div>

<!-- MODAL REPARACION DIARIA -->
<div id="modal-reparacion" class="modal-refactor" tabindex="-1">
  <div class="modal-contenido-refactor modal-erp-producto modal-agregar-producto-grande">
    <span class="cerrar" onclick="cerrarModalReparacion()">&times;</span>
    <h2 class="modal-titulo-principal" id="modal-titulo-reparacion"><i class="fas fa-tools"></i> Nueva Reparacion</h2>

    <form id="form-reparacion" autocomplete="off">
      <div class="form-grid">
        <div>
          <label>Cliente *</label>
          <select id="cliente_tipo" name="cliente_tipo" required>
            <option value="">Seleccione cliente</option>
            <option value="dota">Dota</option>
            <option value="externo">Externo</option>
          </select>
        </div>
      </div>

      <div id="cliente_externo_wrapper" class="form-grid" style="display:none;">
        <div>
          <label>Cliente externo *</label>
          <select id="cliente_id" name="cliente_id">
            <option value="">Seleccione</option>
          </select>
        </div>
      </div>

      <div class="form-grid doble">
        <div>
          <label>ID Reparacion (nuestro) *</label>
          <input type="text" name="id_reparacion" maxlength="20" required />
        </div>
        <div>
          <label>Nro Coche</label>
          <input type="text" name="coche_numero" maxlength="20" />
        </div>
      </div>
      <div class="form-grid">
        <div>
          <label>Nro Pedido (R.Vigente)</label>
          <input type="text" name="nro_pedido_ref" id="nro_pedido_ref" placeholder="Nro de pedido de licitaciones" />
        </div>
      </div>

      <div class="form-grid">
        <div>
          <label>Equipo/Familia *</label>
          <select id="familia_id" name="familia_id">
            <option value="">Seleccione un equipo</option>
          </select>
        </div>
      </div>

      <div class="form-grid">
        <div>
          <label>Tecnico asignado *</label>
          <select id="tecnico_id" name="tecnico_id" required>
            <option value="">Seleccione tecnico</option>
          </select>
        </div>
      </div>

      <div class="form-grid doble">
        <div>
          <label>Hora inicio *</label>
          <input type="time" name="hora_inicio" />
        </div>
        <div>
          <label>Hora fin</label>
          <input type="time" name="hora_fin" />
        </div>
      </div>

      <div class="form-grid">
        <div>
          <label>Trabajo realizado / Repuestos *</label>
          <textarea name="trabajo" id="trabajo" rows="3" required></textarea>
          <!-- Sugerencias para texto predictivo del campo trabajo -->
          <div id="trabajo-suggest" class="suggest-box" style="display:none;"></div>
          <div class="repuestos-actions">
            <input type="text" id="scan-codigo-repuesto" placeholder="Escanear o escribir código de producto y Enter" />
            <div class="repuestos-buttons">
              <button type="button" id="btn-seleccionar-repuesto" class="btn-secundario"><i class="fas fa-cubes"></i> Seleccionar</button>
              <button type="button" id="btn-scan-repuesto" class="btn-secundario"><i class="fas fa-barcode"></i> Escanear Código</button>
            </div>
          </div>
        </div>
      </div>

      <div class="form-grid">
        <div>
          <label>Es garantia?</label>
          <select name="garantia" id="garantia">
            <option value="no">No</option>
            <option value="si">Si</option>
          </select>
        </div>
      </div>

      <div id="garantia-extra-fields" style="display:none; margin-top:10px;">
        <div class="form-grid">
          <div>
            <label for="id_dota">ID DOTA</label>
            <input type="number" name="id_dota" id="id_dota" placeholder="Nro DOTA" />
          </div>
          <div>
            <label for="ultimo_reparador">Ultimo Reparador</label>
            <select name="ultimo_reparador" id="ultimo_reparador">
              <option value="">Seleccione</option>
            </select>
          </div>
          <div>
            <label for="resolucion">Resolucion</label>
            <select name="resolucion" id="resolucion">
              <option value="">Seleccione</option>
              <option value="aceptada">Aceptada</option>
              <option value="rechazada">Rechazada (Facturada)</option>
              <option value="funciona_ok">Funciona OK (Devolucion)</option>
            </select>
          </div>
        </div>
      </div>

      <div class="form-grid">
        <div>
          <label>Observaciones</label>
          <textarea name="observaciones" rows="2"></textarea>
        </div>
      </div>

      <button type="submit" class="btn-guardar"><i class="fas fa-save"></i> Guardar Reparacion</button>
    </form>
  </div>
</div>

<!-- MODAL SCANNER CODIGO/QR -->
<div id="modal-scanner" class="modal-refactor" style="display:none;">
  <div class="modal-contenido-refactor modal-erp-producto" style="max-width:680px;">
    <span class="cerrar" onclick="cerrarModalScanner()">&times;</span>
    <h2 class="modal-titulo-principal"><i class="fas fa-barcode"></i> Escanear Código o QR</h2>
    <div style="display:flex; flex-direction:column; gap:10px;">
      <video id="scanner-video" playsinline style="width:100%; border-radius:8px; background:#000"></video>
      <div style="display:flex; gap:8px; align-items:center;">
        <input id="manual-scan-code" class="input-buscar" placeholder="Ingresar código manualmente" style="flex:1" />
        <button id="btn-add-by-code" class="btn-primary"><i class="fas fa-plus"></i> Agregar</button>
      </div>
      <small style="color:#64748b;">Tip: Permití el uso de la cámara. Si tu navegador no soporta detector, ingresá el código manualmente.</small>
    </div>
  </div>
</div>

<!-- MODAL GRUPOS -->
<div id="modal-grupos" class="modal-refactor">
  <div class="modal-contenido modal-erp-producto tabla-chica">
    <span class="cerrar" onclick="cerrarModalGrupos()">&times;</span>
    <h2 class="modal-titulo-principal"><i class="fas fa-layer-group"></i> Seleccionar Grupo</h2>
    <div class="erp-table-card">
      <table class="tabla-erp">
        <thead>
          <tr>
            <th>Seleccionar</th>
            <th>Grupo</th>
          </tr>
        </thead>
        <tbody id="tbody-grupos"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- MODAL PRODUCTOS -->
<div id="modal-productos" class="modal-refactor">
  <div class="modal-contenido modal-erp-producto tabla-chica">
    <span class="cerrar" onclick="cerrarModalProductos()">&times;</span>
    <h2 class="modal-titulo-principal"><i class="fas fa-box"></i> Seleccionar Producto</h2>
    <div class="buscador-historial" style="margin-top:0;">
      <input type="text" id="buscar-producto-planilla" class="input-buscar" placeholder="Buscar por código o descripción..." />
      <button id="btn-buscar-producto-planilla" class="btn-primary"><i class="fas fa-search"></i> Buscar</button>
    </div>
    <div class="erp-table-card">
      <table class="tabla-erp">
        <thead>
          <tr>
            <th>Accion</th>
            <th>Descripcion</th>
            <th>Codigo</th>
            <th>Stock</th>
          </tr>
        </thead>
        <tbody id="tbody-productos"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- MODAL DETALLE -->
<div id="modal-detalle" class="modal-refactor">
  <div class="modal-contenido modal-erp-producto tabla-chica">
    <span class="cerrar" onclick="cerrarModalDetalle()">&times;</span>
    <h2 class="modal-titulo-principal"><i class="fas fa-info-circle"></i> Detalle de Reparacion</h2>
    <div class="detalle-grid">
      <p><b>Cliente:</b> <span id="detalle-cliente"></span></p>
      <p><b>ID Reparacion:</b> <span id="detalle-id-reparacion"></span></p>
      <p><b>Nro Coche:</b> <span id="detalle-coche"></span></p>
      <p><b>Equipo:</b> <span id="detalle-equipo"></span></p>
      <p><b>Tecnico:</b> <span id="detalle-tecnico"></span></p>
      <p><b>Hora inicio:</b> <span id="detalle-hora-inicio">-</span></p>
      <p><b>Hora fin:</b> <span id="detalle-hora-fin">-</span></p>
      <p><b>Trabajo:</b> <span id="detalle-trabajo">-</span></p>
      <p><b>Garantia:</b> <span id="detalle-garantia"></span></p>
      <div id="detalle-garantia-extra" style="display:none;">
        <p><b>ID DOTA:</b> <span id="detalle-id-dota"></span></p>
        <p><b>Ultimo reparador:</b> <span id="detalle-ultimo-reparador"></span></p>
        <p><b>Resolucion:</b> <span id="detalle-resolucion"></span></p>
      </div>
    </div>
  </div>
</div>

<!-- MODAL HISTORIAL -->
<div id="modal-historial" class="modal-refactor">
  <div class="modal-contenido modal-historial-ancho">
    <span class="cerrar" onclick="cerrarModalHistorial()">&times;</span>
    <h2 class="modal-titulo-principal"><i class="fas fa-history"></i> Historial de Reparaciones</h2>

    <div class="historial-header">
      <div><b>ID Reparacion:</b> <span id="historial-id"></span></div>
      <div><b>Cliente:</b> <span id="historial-cliente"></span></div>
      <div><b>Equipo:</b> <span id="historial-equipo"></span></div>
      <div><b>Nro Coche:</b> <span id="historial-coche"></span></div>
    </div>

    <div id="historial-garantia-extra" class="historial-header garantia-extra" style="display:none;">
      <div><b>ID DOTA:</b> <span id="historial-id-dota">-</span></div>
      <div><b>Ultimo reparador:</b> <span id="historial-ultimo-reparador">-</span></div>
      <div><b>Resolucion:</b> <span id="historial-resolucion">-</span></div>
    </div>

    <div class="erp-table-card historial-tabla">
      <table class="tabla-erp">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Trabajo</th>
            <th>Hora Inicio</th>
            <th>Hora Fin</th>
            <th>Tecnico</th>
            <th>Garantia</th>
          </tr>
        </thead>
        <tbody id="tbody-historial"></tbody>
      </table>
    </div>
  </div>
</div>

